# 32. 声明合并 (Declaration Merging)

## 概念定义

**声明合并**是 TypeScript 中的一个重要特性，它允许将多个同名的声明合并为一个单一的声明。当 TypeScript 编译器遇到多个相同名称的声明时，它会自动将它们合并成一个定义。

## 语法示例

### 接口合并
```typescript
interface User {
  name: string;
}

interface User {
  age: number;
}

// 合并后的 User 接口
const user: User = {
  name: "Alice",
  age: 25
};
```

### 命名空间合并
```typescript
namespace Utils {
  export function formatDate(date: Date): string {
    return date.toISOString();
  }
}

namespace Utils {
  export function formatCurrency(amount: number): string {
    return `$${amount.toFixed(2)}`;
  }
}

// 使用合并后的命名空间
Utils.formatDate(new Date());
Utils.formatCurrency(100);
```

### 函数重载合并
```typescript
function processInput(input: string): string;
function processInput(input: number): number;
function processInput(input: string | number): string | number {
  if (typeof input === "string") {
    return input.toUpperCase();
  } else {
    return input * 2;
  }
}
```

## 使用场景

### 1. 扩展第三方库类型
当使用第三方库时，可以通过声明合并来扩展其类型定义：

```typescript
// 扩展 jQuery 的类型定义
declare namespace JQuery {
  interface AjaxSettings {
    timeout?: number;
    retryCount?: number;
  }
}
```

### 2. 模块增强
为现有模块添加新的功能：

```typescript
// 原始模块
declare module "my-module" {
  export function originalFunction(): void;
}

// 扩展模块
declare module "my-module" {
  export function newFunction(): void;
}
```

### 3. 全局变量扩展
为全局对象添加新的属性：

```typescript
// 扩展 Window 接口
interface Window {
  myCustomProperty: string;
  myCustomMethod(): void;
}

// 使用扩展的属性
window.myCustomProperty = "value";
window.myCustomMethod();
```

## 注意事项

### 合并规则
1. **接口合并**：合并后的接口包含所有声明中的成员
2. **命名空间合并**：导出成员会合并，非导出成员只在各自命名空间内可见
3. **函数合并**：通过函数重载实现，需要提供具体的实现签名

### 合并限制
- 不能合并变量和类
- 合并的声明必须在同一作用域内
- 合并时类型必须兼容，否则会产生错误

### 最佳实践
```typescript
// 良好的合并实践
interface Config {
  baseUrl: string;
}

interface Config {
  timeout: number;
}

// 避免的类型冲突
interface BadExample {
  value: string;
}

interface BadExample {
  value: number; // 错误：属性 'value' 的类型不兼容
}
```

## 示例代码位置

相关示例代码请查看：`examples/32-declaration-merging.ts`

---

**上一节**: [31-常量断言](./31-常量断言.md)  
**下一节**: [33-装饰器](./33-装饰器.md)  
**返回目录**: [高级特性目录](../高级特性/)