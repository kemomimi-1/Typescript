# 函数类型兼容性

## 概念定义

**函数类型兼容性** 是指 TypeScript 中判断两个函数类型是否可以相互赋值或使用的规则。TypeScript 使用结构化类型系统，基于类型的形状（shape）而不是名称来判断兼容性。

## 语法示例

### 参数兼容性规则
```typescript
// 源函数类型
type SourceFunc = (x: number, y: number) => number;

// 目标函数类型 - 参数数量更少
type TargetFunc1 = (x: number) => number;

// 目标函数类型 - 参数类型更宽泛  
type TargetFunc2 = (x: any, y: any) => number;

// 兼容性检查
let func1: TargetFunc1 = (x: number, y: number) => x + y; // ✅ 兼容
let func2: TargetFunc2 = (x: number, y: number) => x + y; // ✅ 兼容
```

### 返回值兼容性规则
```typescript
// 源函数类型
type SourceFunc = () => number;

// 目标函数类型 - 返回值类型更具体
type TargetFunc1 = () => 42;

// 目标函数类型 - 返回值类型更宽泛
type TargetFunc2 = () => any;

// 兼容性检查
let func1: TargetFunc1 = () => 42; // ✅ 兼容
let func2: TargetFunc2 = () => 42; // ✅ 兼容
```

## 使用场景说明

1. **回调函数传递**：将具体实现的函数传递给期望更通用函数类型的地方
2. **高阶函数**：函数作为参数或返回值时的类型兼容性判断
3. **API 设计**：设计灵活的接口，允许用户提供不同详细程度的函数实现
4. **库函数兼容**：确保第三方库的函数与用户代码的类型兼容

## 注意事项

1. **参数数量**：目标函数可以接受比源函数更少的参数
2. **参数类型**：目标函数的参数类型必须包含源函数的参数类型
3. **返回值类型**：源函数的返回值类型必须包含目标函数的返回值类型
4. **可选参数**：可选参数不影响兼容性判断
5. **rest 参数**：rest 参数被视为无限可选参数

## 相关代码示例

参见：[examples/39-function-compatibility.ts](../examples/39-function-compatibility.ts)

## 总结

函数类型兼容性遵循"参数逆变，返回值协变"的原则：
- 参数：目标 ≤ 源（数量更少，类型更宽）
- 返回值：源 ≤ 目标（类型更具体或相同）

---

**最后更新时间**：2025-11-21  
**相关主题**：[类型兼容性](./37-类型兼容性.md) | [函数类型](../类型系统/10-函数类型.md)