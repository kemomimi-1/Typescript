# TypeScript 可选参数

## 概述
可选参数允许函数参数是可选的，使用 `?` 修饰符标记。这提供了更大的灵活性，同时保持类型安全。

## 基本语法

### 声明可选参数
```typescript
function greet(name: string, title?: string): string {
  return title ? `Hello, ${title} ${name}!` : `Hello, ${name}!`;
}
```

### 使用可选参数
```typescript
greet("Alice");                    // "Hello, Alice!"
greet("Bob", "Dr.");              // "Hello, Dr. Bob!"
```

## 可选参数与默认参数

### 可选参数
```typescript
function createUser(name: string, age?: number) {
  return { name, age };
}
```

### 默认参数
```typescript
function createUser(name: string, age: number = 18) {
  return { name, age };
}
```

### 区别
- **可选参数**：调用时可以省略，值为 undefined
- **默认参数**：调用时可以省略，使用默认值

## 多个可选参数

### 多个可选参数
```typescript
function configure(
  options?: {
    timeout?: number;
    retries?: number;
    debug?: boolean;
  }
) {
  // 处理配置
}
```

### 使用对象解构
```typescript
function configure({
  timeout = 5000,
  retries = 3,
  debug = false
}: {
  timeout?: number;
  retries?: number;
  debug?: boolean;
} = {}) {
  // 使用默认值
}
```

## 可选参数的位置

### 必需参数在前
```typescript
// 正确：必需参数在前
function correct(name: string, age?: number) {}

// 错误：可选参数不能在必需参数前
// function wrong(age?: number, name: string) {}
```

### 多个可选参数
```typescript
function createProfile(
  name: string,
  age?: number,
  email?: string,
  phone?: string
) {
  // 所有可选参数都在最后
}
```

## 类型推断

### 可选参数的类型
```typescript
function process(value?: string) {
  // value 的类型是 string | undefined
  if (value) {
    console.log(value.toUpperCase()); // value 是 string
  }
}
```

### 类型守卫
```typescript
function validateInput(input?: string): boolean {
  if (typeof input === "string") {
    return input.length > 0;
  }
  return false; // input 是 undefined
}
```

## 可选参数与联合类型

### 显式联合类型
```typescript
function processInput(input: string | undefined) {
  // 与可选参数类似
}

processInput("hello");
processInput(undefined);
```

### 区别
```typescript
// 可选参数
function withOptional(param?: string) {}

// 显式 undefined
function withExplicit(param: string | undefined) {}

withOptional();          // 允许省略
withExplicit(undefined); // 必须显式传递 undefined
```

## 回调函数中的可选参数

### 事件处理函数
```typescript
type ClickHandler = (event?: MouseEvent) => void;

const handleClick: ClickHandler = (event) => {
  if (event) {
    console.log(event.clientX);
  }
};
```

### 可选回调参数
```typescript
function fetchData(
  url: string,
  onSuccess?: (data: any) => void,
  onError?: (error: Error) => void
) {
  // 调用回调（如果提供）
  onSuccess?.(data);
  onError?.(error);
}
```

## 配置对象模式

### 使用配置对象
```typescript
interface Config {
  timeout?: number;
  retries?: number;
  debug?: boolean;
}

function setup(config: Config = {}) {
  const {
    timeout = 5000,
    retries = 3,
    debug = false
  } = config;
  
  // 使用配置
}
```

### 优点
- 参数顺序无关
- 易于扩展
- 清晰的配置结构

## 可选参数的最佳实践

### 1. 使用配置对象处理多个可选参数
```typescript
// 好的实践
function createUser(options: {
  name: string;
  age?: number;
  email?: string;
}) {
  // 处理参数
}
```

### 2. 为可选参数提供默认值
```typescript
function createMessage(
  text: string,
  priority: number = 1,
  category: string = "general"
) {
  return { text, priority, category };
}
```

### 3. 使用类型守卫处理可选参数
```typescript
function processInput(input?: string) {
  if (input && input.trim().length > 0) {
    // 处理有效输入
  }
  // 处理空或未定义输入
}
```

## 常见错误

### 1. 可选参数位置错误
```typescript
// 错误：可选参数不能在必需参数前
function wrong(age?: number, name: string) {}
```

### 2. 混淆可选参数和默认参数
```typescript
function confuse(param?: string = "default") {
  // 语法错误：不能同时使用 ? 和默认值
}
```

### 3. 忘记处理 undefined
```typescript
function dangerous(param?: string) {
  console.log(param.toUpperCase()); // 可能运行时错误
}
```

## 实用技巧

### 1. 空值合并运算符
```typescript
function greet(name: string, title?: string) {
  return `Hello, ${title ?? ""} ${name}`.trim();
}
```

### 2. 可选链操作符
```typescript
function processConfig(config?: {
  options?: {
    timeout?: number;
  };
}) {
  const timeout = config?.options?.timeout ?? 5000;
}
```

### 3. 解构默认值
```typescript
function createUser({
  name,
  age = 18,
  email = ""
}: {
  name: string;
  age?: number;
  email?: string;
}) {
  return { name, age, email };
}
```

## 练习建议

1. 练习使用可选参数和默认参数
2. 尝试配置对象模式处理多个可选参数
3. 使用类型守卫安全处理可选参数
4. 比较可选参数和联合类型的区别
5. 体验可选链和空值合并运算符

---
最后更新: 2025-11-20