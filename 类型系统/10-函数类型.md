# TypeScript 函数类型

## 概述
函数是 JavaScript 中的一等公民，TypeScript 为函数提供了完整的类型支持，包括参数类型、返回值类型和函数重载。

## 函数声明类型注解

### 基本函数声明
```typescript
function greet(name: string): string {
  return `Hello, ${name}!`;
}
```

### 箭头函数类型注解
```typescript
const add = (a: number, b: number): number => a + b;
```

### 函数表达式类型注解
```typescript
const multiply: (a: number, b: number) => number = function(a, b) {
  return a * b;
};
```

## 参数类型注解

### 必需参数
```typescript
function createUser(name: string, age: number) {
  return { name, age };
}
```

### 可选参数
```typescript
function greet(name: string, title?: string) {
  return title ? `Hello, ${title} ${name}!` : `Hello, ${name}!`;
}
```

### 默认参数
```typescript
function createMessage(text: string, priority: number = 1) {
  return { text, priority };
}
```

### 剩余参数
```typescript
function sum(...numbers: number[]): number {
  return numbers.reduce((acc, n) => acc + n, 0);
}
```

## 返回值类型注解

### 明确返回值类型
```typescript
function getRandomNumber(): number {
  return Math.random();
}
```

### void 返回值
```typescript
function logMessage(message: string): void {
  console.log(message);
}
```

### never 返回值
```typescript
function throwError(message: string): never {
  throw new Error(message);
}
```

## 函数类型表达式

### 类型别名函数类型
```typescript
type GreetFunction = (name: string) => string;

const greet: GreetFunction = (name) => `Hello, ${name}!`;
```

### 接口函数类型
```typescript
interface MathOperation {
  (a: number, b: number): number;
}

const add: MathOperation = (a, b) => a + b;
```

## 函数重载

### 重载签名
```typescript
function makeDate(timestamp: number): Date;
function makeDate(year: number, month: number, day: number): Date;
```

### 实现签名
```typescript
function makeDate(yearOrTimestamp: number, month?: number, day?: number): Date {
  if (month !== undefined && day !== undefined) {
    return new Date(yearOrTimestamp, month, day);
  } else {
    return new Date(yearOrTimestamp);
  }
}
```

### 使用重载函数
```typescript
const d1 = makeDate(12345678);          // 使用时间戳
const d2 = makeDate(2023, 11, 20);      // 使用年月日
```

## 上下文类型推断

### 回调函数类型推断
```typescript
const numbers = [1, 2, 3, 4, 5];

// TypeScript 推断 n 为 number 类型
const doubled = numbers.map(n => n * 2);
```

### 事件处理函数
```typescript
document.addEventListener("click", (event) => {
  // event 被推断为 MouseEvent 类型
  console.log(event.clientX, event.clientY);
});
```

## 函数类型兼容性

### 参数类型兼容性
```typescript
type Handler = (event: Event) => void;

const myHandler: Handler = (e: MouseEvent) => {
  console.log(e.clientX);
};
// 允许，因为 MouseEvent 是 Event 的子类型
```

### 返回值类型兼容性
```typescript
type NumberGenerator = () => number;

const getNumber: NumberGenerator = () => {
  return Math.random(); // 返回 number
};
```

## 高阶函数

### 函数作为参数
```typescript
function processNumbers(
  numbers: number[], 
  processor: (n: number) => number
): number[] {
  return numbers.map(processor);
}

const result = processNumbers([1, 2, 3], n => n * 2); // [2, 4, 6]
```

### 函数作为返回值
```typescript
function createMultiplier(factor: number): (n: number) => number {
  return (n) => n * factor;
}

const double = createMultiplier(2);
console.log(double(5)); // 10
```

## 泛型函数

### 基本泛型函数
```typescript
function identity<T>(value: T): T {
  return value;
}

let result = identity<string>("hello"); // string
let numberResult = identity(42);        // number（类型推断）
```

### 约束泛型类型
```typescript
function getProperty<T, K extends keyof T>(obj: T, key: K): T[K] {
  return obj[key];
}

const person = { name: "Alice", age: 25 };
let name = getProperty(person, "name"); // string
let age = getProperty(person, "age");   // number
```

## 异步函数

### async/await 类型
```typescript
async function fetchData(url: string): Promise<string> {
  const response = await fetch(url);
  return response.text();
}
```

### 错误处理
```typescript
async function safeFetch(url: string): Promise<string | null> {
  try {
    const response = await fetch(url);
    return response.text();
  } catch {
    return null;
  }
}
```

## 函数类型操作

### 提取函数类型
```typescript
type MyFunction = (a: number, b: string) => boolean;

type Params = Parameters<MyFunction>;    // [number, string]
type Return = ReturnType<MyFunction>;    // boolean
```

### 构造函数类型
```typescript
type Constructor = new (...args: any[]) => any;

class MyClass {}

function createInstance(ctor: Constructor) {
  return new ctor();
}
```

## 最佳实践

### 1. 总是注解返回值类型
```typescript
// 好的实践
function calculateTotal(price: number, quantity: number): number {
  return price * quantity;
}
```

### 2. 使用可选参数而不是重载
```typescript
// 优先使用可选参数
function createUser(name: string, age?: number) {}

// 而不是重载
function createUser(name: string): User;
function createUser(name: string, age: number): User;
```

### 3. 利用类型推断
```typescript
// 让 TypeScript 推断简单类型
const numbers = [1, 2, 3];
const doubled = numbers.map(n => n * 2); // 推断为 number[]
```

### 4. 使用函数类型别名
```typescript
type ClickHandler = (event: MouseEvent) => void;

const handleClick: ClickHandler = (event) => {
  console.log(event.clientX);
};
```

## 常见错误

### 1. 忘记返回值类型注解
```typescript
function process() { // 缺少返回类型注解
  return Math.random();
}
```

### 2. 参数类型不匹配
```typescript
function greet(name: string) {}

greet(42); // 错误：参数类型不匹配
```

### 3. 重载签名不完整
```typescript
function process(input: string): string;
function process(input: number): number; 
// 缺少实现签名
```

### 4. 混淆函数类型语法
```typescript
// 错误：混淆了类型别名和函数声明
type MyFunction = function(a: number): number;

// 正确
type MyFunction = (a: number) => number;
```

## 练习建议

1. 为现有函数添加类型注解
2. 练习使用函数重载
3. 创建高阶函数类型
4. 使用泛型函数处理多种类型
5. 体验异步函数的类型安全
6. 比较函数类型别名和接口函数类型

---
最后更新: 2025-11-20