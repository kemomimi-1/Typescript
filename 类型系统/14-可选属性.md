# TypeScript 可选属性

## 概述
可选属性允许对象中的某些属性是可选的，使用 `?` 修饰符标记。这提供了对象结构的灵活性，同时保持类型安全。

## 基本语法

### 接口中的可选属性
```typescript
interface User {
  id: number;
  name: string;
  email?: string; // 可选属性
  phone?: string; // 可选属性
}
```

### 类型别名中的可选属性
```typescript
type Product = {
  id: number;
  name: string;
  description?: string; // 可选属性
  price: number;
};
```

## 使用可选属性

### 创建对象实例
```typescript
const user1: User = {
  id: 1,
  name: "Alice"
  // email 和 phone 是可选的，可以省略
};

const user2: User = {
  id: 2,
  name: "Bob",
  email: "bob@example.com"
  // 只提供部分可选属性
};
```

### 访问可选属性
```typescript
function getUserEmail(user: User): string | undefined {
  return user.email; // 可能是 string 或 undefined
}

function displayUserInfo(user: User): void {
  console.log(`Name: ${user.name}`);
  if (user.email) {
    console.log(`Email: ${user.email}`);
  }
  if (user.phone) {
    console.log(`Phone: ${user.phone}`);
  }
}
```

## 可选属性与默认值

### 使用默认值处理可选属性
```typescript
interface Config {
  host: string;
  port?: number;
  timeout?: number;
}

function createConnection(config: Config) {
  const port = config.port ?? 8080; // 默认端口
  const timeout = config.timeout ?? 5000; // 默认超时
  
  console.log(`Connecting to ${config.host}:${port} (timeout: ${timeout}ms)`);
}
```

### 解构赋值与默认值
```typescript
function processUser({ name, email = "", phone = "" }: User) {
  console.log(`Name: ${name}`);
  if (email) console.log(`Email: ${email}`);
  if (phone) console.log(`Phone: ${phone}`);
}
```

## 嵌套可选属性

### 嵌套对象中的可选属性
```typescript
interface Address {
  street: string;
  city: string;
  zipCode?: string;
  country?: string;
}

interface User {
  id: number;
  name: string;
  address?: Address; // 整个地址对象是可选的
}
```

### 访问嵌套可选属性
```typescript
function getUserCountry(user: User): string | undefined {
  return user.address?.country; // 可选链操作符
}

function getFullAddress(user: User): string {
  if (!user.address) return "No address provided";
  
  const { street, city, zipCode, country } = user.address;
  return `${street}, ${city}${zipCode ? `, ${zipCode}` : ""}${country ? `, ${country}` : ""}`;
}
```

## 可选属性与索引签名

### 索引签名中的可选属性
```typescript
interface StringMap {
  [key: string]: string | undefined;
  required: string; // 必须符合索引签名
  optional?: string; // 可选属性
}

const map: StringMap = {
  required: "value",
  // optional 可以省略
};
```

### 严格的索引签名
```typescript
interface StrictConfig {
  name: string;
  [key: string]: string | number | undefined; // 必须包含所有属性类型
  timeout?: number; // 必须符合索引签名
  retries?: number;
}
```

## 可选属性的类型推断

### 自动类型推断
```typescript
interface Person {
  name: string;
  age?: number;
}

const person: Person = { name: "Alice" };
// person.age 的类型是 number | undefined
```

### 类型守卫
```typescript
function processPerson(person: Person) {
  console.log(`Name: ${person.name}`);
  
  if (typeof person.age === "number") {
    console.log(`Age: ${person.age}`);
  } else {
    console.log("Age not provided");
  }
}
```

## 可选属性与函数参数

### 配置对象模式
```typescript
interface CreateUserOptions {
  name: string;
  email?: string;
  phone?: string;
  sendWelcomeEmail?: boolean;
}

function createUser(options: CreateUserOptions): User {
  const user = {
    id: generateId(),
    name: options.name,
    email: options.email,
    phone: options.phone
  };
  
  if (options.sendWelcomeEmail && options.email) {
    sendWelcomeEmail(options.email);
  }
  
  return user;
}
```

### 默认参数值
```typescript
function createUser({
  name,
  email = "",
  phone = "",
  sendWelcomeEmail = false
}: CreateUserOptions): User {
  // 使用解构默认值
  return { id: generateId(), name, email, phone };
}
```

## 可选属性的最佳实践

### 1. 使用可选属性而不是联合类型
```typescript
// 好的实践
interface User {
  id: number;
  name: string;
  email?: string;
}

// 避免
interface User {
  id: number;
  name: string;
  email: string | undefined;
}
```

### 2. 为可选属性提供合理的默认值
```typescript
function createConfig(config: Partial<Config>): Config {
  return {
    host: config.host ?? "localhost",
    port: config.port ?? 8080,
    timeout: config.timeout ?? 5000
  };
}
```

### 3. 使用可选链安全访问
```typescript
// 安全的访问方式
const country = user.address?.country ?? "Unknown";
const city = user.address?.city ?? "Unknown";
```

### 4. 文档化可选属性
```typescript
interface ApiResponse {
  data: any;
  /** 错误信息，仅在出错时存在 */
  error?: string;
  /** 时间戳 */
  timestamp: number;
}
```

## 常见错误

### 1. 忘记处理 undefined
```typescript
function dangerous(user: User) {
  console.log(user.email.toUpperCase()); // 可能运行时错误
}
```

### 2. 混淆可选属性和必需属性
```typescript
interface Config {
  host: string;
  port?: number;
}

const config: Config = { host: "example.com" };
// console.log(config.port.toString()); // 可能错误
```

### 3. 索引签名冲突
```typescript
interface Problematic {
  [key: string]: string; // 所有属性必须是 string
  optional?: number;     // 错误：number 不能赋值给 string
}
```

## 实用技巧

### 1. 使用 Partial 类型
```typescript
interface User {
  id: number;
  name: string;
  email: string;
}

function updateUser(id: number, updates: Partial<User>) {
  // 只更新提供的属性
}
```

### 2. 使用 Required 类型
```typescript
function createFullUser(data: Required<User>) {
  // 所有属性都必须提供
}
```

### 3. 条件类型与可选属性
```typescript
type OptionalKeys<T> = {
  [K in keyof T]: undefined extends T[K] ? K : never;
}[keyof T];

type RequiredKeys<T> = {
  [K in keyof T]: undefined extends T[K] ? never : K;
}[keyof T];
```

## 练习建议

1. 创建包含可选属性的接口和类型别名
2. 练习使用可选链操作符安全访问属性
3. 使用解构默认值处理可选属性
4. 体验 Partial 和 Required 工具类型
5. 比较可选属性和联合类型的区别

---
最后更新: 2025-11-20