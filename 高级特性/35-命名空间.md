# 35. 命名空间 (Namespaces)

## 概念定义

**命名空间**是 TypeScript 中用于组织代码的一种方式，它可以将相关的代码组织在一起，避免全局命名冲突。命名空间使用 `namespace` 关键字定义，可以包含变量、函数、类、接口等。

## 语法示例

### 基础命名空间
```typescript
namespace Utilities {
  export function formatDate(date: Date): string {
    return date.toLocaleDateString();
  }
  
  export function formatCurrency(amount: number): string {
    return `$${amount.toFixed(2)}`;
  }
  
  // 未导出的成员在命名空间外不可见
  function internalHelper() {
    // 内部辅助函数
  }
}

// 使用命名空间中的函数
const today = Utilities.formatDate(new Date());
const price = Utilities.formatCurrency(99.99);
```

### 嵌套命名空间
```typescript
namespace App {
  export namespace Services {
    export class UserService {
      getUsers() {
        return [];
      }
    }
  }
  
  export namespace Utils {
    export function logger(message: string) {
      console.log(`[APP] ${message}`);
    }
  }
}

// 使用嵌套命名空间
const userService = new App.Services.UserService();
App.Utils.logger("Service created");
```

### 多文件命名空间
```typescript
// validation.ts
namespace Validation {
  export interface StringValidator {
    isAcceptable(s: string): boolean;
  }
}

// email-validation.ts
/// <reference path="validation.ts" />
namespace Validation {
  export class EmailValidator implements StringValidator {
    isAcceptable(s: string): boolean {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s);
    }
  }
}

// usage.ts
/// <reference path="validation.ts" />
/// <reference path="email-validation.ts" />
const validator = new Validation.EmailValidator();
console.log(validator.isAcceptable("test@example.com"));
```

## 使用场景

### 1. 代码组织
```typescript
namespace MathOperations {
  export function add(a: number, b: number): number {
    return a + b;
  }
  
  export function subtract(a: number, b: number): number {
    return a - b;
  }
  
  export function multiply(a: number, b: number): number {
    return a * b;
  }
  
  export function divide(a: number, b: number): number {
    if (b === 0) throw new Error("Division by zero");
    return a / b;
  }
  
  // 内部实现细节
  namespace Internal {
    export function validateNumber(num: number): boolean {
      return !isNaN(num);
    }
  }
}

// 使用组织好的数学运算
const result = MathOperations.add(10, 5);
const product = MathOperations.multiply(3, 4);
```

### 2. 第三方库开发
```typescript
// 库的入口文件
namespace MyLibrary {
  export const version = "1.0.0";
  
  export function initialize(config: any) {
    console.log("Library initialized with config:", config);
  }
  
  // 子模块
  export namespace DOM {
    export function getElement(id: string): HTMLElement | null {
      return document.getElementById(id);
    }
    
    export function createElement(tag: string): HTMLElement {
      return document.createElement(tag);
    }
  }
  
  export namespace Events {
    export function on(element: HTMLElement, event: string, handler: Function) {
      element.addEventListener(event, handler as any);
    }
    
    export function off(element: HTMLElement, event: string, handler: Function) {
      element.removeEventListener(event, handler as any);
    }
  }
}

// 使用库
MyLibrary.initialize({ debug: true });
const button = MyLibrary.DOM.createElement("button");
MyLibrary.Events.on(button, "click", () => console.log("Clicked!"));
```

### 3. 类型定义组织
```typescript
namespace DataTypes {
  export interface User {
    id: number;
    name: string;
    email: string;
  }
  
  export interface Product {
    id: number;
    name: string;
    price: number;
    category: string;
  }
  
  export interface Order {
    id: number;
    userId: number;
    products: Product[];
    total: number;
    status: OrderStatus;
  }
  
  export enum OrderStatus {
    PENDING = "pending",
    PROCESSING = "processing",
    COMPLETED = "completed",
    CANCELLED = "cancelled"
  }
}

// 使用定义的类型
function processOrder(order: DataTypes.Order) {
  if (order.status === DataTypes.OrderStatus.PENDING) {
    console.log("Processing pending order");
  }
}
```

## 注意事项

### 编译输出
命名空间会被编译为 JavaScript 对象：
```typescript
// TypeScript
namespace MyApp {
  export function hello() {}
}

// 编译后的 JavaScript
var MyApp;
(function (MyApp) {
  function hello() { }
  MyApp.hello = hello;
})(MyApp || (MyApp = {}));
```

### 与模块的区别
```typescript
// 命名空间（主要用于组织代码）
namespace Utilities {
  export function helper() {}
}

// ES6 模块（主要用于文件模块化）
export function helper() {}

// 使用方式不同
Utilities.helper();  // 命名空间
import { helper } from './utilities';  // 模块
```

### 最佳实践
```typescript
// 1. 使用 /// <reference> 进行文件间引用
/// <reference path="validation.ts" />

// 2. 合理使用嵌套命名空间
namespace Company.App.Module {
  export class Service {}
}

// 3. 考虑使用模块替代命名空间
// 对于新项目，推荐使用 ES6 模块
// 命名空间更适合传统的脚本组织

// 4. 避免过度嵌套
namespace Level1.Level2.Level3.Level4 {
  // 过度嵌套会使代码难以维护
}
```

### 现代替代方案
```typescript
// 使用模块代替命名空间
// utilities.ts
export function formatDate(date: Date): string {
  return date.toLocaleDateString();
}

export function formatCurrency(amount: number): string {
  return `$${amount.toFixed(2)}`;
}

// 使用模块
import { formatDate, formatCurrency } from './utilities';

const today = formatDate(new Date());
const price = formatCurrency(99.99);
```

## 示例代码位置

相关示例代码请查看：`examples/35-namespaces.ts`

---

**上一节**: [34-混入](./34-混入.md)  
**下一节**: [36-模块](./36-模块.md)  
**返回目录**: [高级特性目录](../高级特性/)